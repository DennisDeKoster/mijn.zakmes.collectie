<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mijn zakmes collectie</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Space+Grotesk:wght@400;700&family=Sora:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="styles.css">
    <script>
        let activeBrand = null;
        async function loadItems() {
            const response = await fetch('database.json');
            const text = await response.text();
            const items = JSON.parse(text);
            const container = document.getElementById('itemContainer');
            container.innerHTML = '';
            items.forEach(item => {
                const card = document.createElement('div');
                card.classList.add('card');
                card.dataset.merk = (item.merk || '')
                    .toLowerCase()
                    .trim()
                    .replace(/\s+/g, ' ');
                if (item.type === 'zaklamp') {
                    card.dataset.type = 'zaklamp';
                    card.innerHTML = `
                        <div class="card-content shine-hover">
                            <div class="specs">
                                <div class="row">
                                    <div class="topleft">
                                        <h2>
                                            <span class="merk">${item.merk || ''}</span><br>
                                            <span class="naam">${item.naam || ''}</span><br>
                                            <div class="uitvoering" style="font-size: 0.8em; white-space: nowrap; display: inline-block;">
                                                <strong>${item.uitvoering || ''}</strong>
                                            </div>
                                        </h2>
                                    </div>
                                    <div class="topright">
                                        <a href="${item.link || '#'}" class="link-image" target="_blank">
                                            <img src="${item.afbeelding || ''}" alt="${item.naam || 'Zaklamp'}">
                                        </a>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="left">
                                        <div class="maxLumen"><strong>Maximaal aantal lumen:</strong><br>${item.maxLumen || '-'} lm</div>
                                        <div class="maxBereik"><strong>Maximaal bereik:</strong><br>${item.maxBereik || '-'} m</div>
                                        <div class="maxAccu"><strong>Maximale accuduur:</strong><br>${item.maxRuntime || '-'}</div>
                                        <div class="batterij"><strong>Batterij:</strong><br>${item.batterij || '-'}</div>
                                        <div class="oplaadbaar"><strong>Oplaadbaar:</strong><br>${item.oplaadbaar ? 'Ja' + (item.usbType ? ' (' + item.usbType + ')' : '') : 'Nee'}</div>
                                        <div class="nieuwwaarde"><strong>Nieuwwaarde:</strong><br>‚Ç¨ ${item.nieuwwaarde || 0}</div>
                                        <div class="aankoopwaarde"><strong>Aankoopwaarde:</strong><br>‚Ç¨ ${item.aankoopwaarde || 0}</div>
                                        <div class="aankoopdatum"><strong>Aankoopdatum:</strong><br>${item.aankoopdatum || '-'}</div>
                                        ${item.specials ? `
                                            <div class="specials">
                                                <strong>Bijzonderheden:</strong><br>
                                                ${item.specials.map(s =>
                                                    `<div>${s.link ? `<a href="${s.link}" target="_blank">${s.description}</a>` : s.description}</div>`
                                                ).join('')}
                                            </div>
                                        ` : ''}
                                    </div>
                                    <div class="right">
                                        ${item.lightingLevels ? `<div class="specials"><strong>Lichtmodi:</strong><br>
                                            ${item.lightingLevels.map(s =>`<div>${s.description}</div>`).join('')}</div>` : ''}
                                        <div class="specmodi"><strong>Speciale modi:</strong><br>
                                        ${(() => {
                                            const active = [];
                                            if (item.strobe)  active.push('Strobe');
                                            if (item.sos)     active.push('SOS');
                                            if (item.beacon)  active.push('Beacon');
                                            return active.length ? active.join(', ') : 'Geen';
                                        })()}
                                        </div>
                                        <div class="materiaal"><strong>Materiaal:</strong><br>${item.materiaal || '-'}</div>
                                        <div class="iprating"><strong>IP-norm:</strong><br>${item.iprating || '-'}</div>
                                        <div class="lengte"><strong>Lengte:</strong><br>${item.lengte || '-'} mm</div>
                                        <div class="dikte"><strong>Dikte:</strong><br>${item.dikte || '-'} mm</div>
                                        <div class="gewicht"><strong>Gewicht:</strong><br>${item.gewicht || '-'} g</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                } else {
                    card.dataset.type = 'mes';
                    card.innerHTML = `
                        <div class="card-content shine-hover">
                            <div class="specs">
                                <div class="row">
                                    <div class="topleft">
                                        <h2>
                                            <span class="merk">${item.merk}</span><br>
                                            <span class="naam">${item.naam}</span><br>
                                            <div class="uitvoering" style="font-size: 0.8em; white-space: nowrap; display: inline-block;"><strong><b>${item.uitvoering}</b></strong></div>
                                        </h2>
                                    </div>
                                    <div class="topright">
                                        <a href="${item.link}" class="link-image" target="_blank">
                                            <img src="${item.afbeelding}" alt="${item.naam}">
                                        </a>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="left">
                                        <div class="staalsoort"><strong>Staalsoort:</strong><br>${item.staalsoort}</div>
                                        <div class="lemmetVorm"><strong>Lemmet vorm:</strong><br>${item.lemmetVorm}</div>
                                        <div class="openmethode"><strong>Openmethode:</strong><br>${item.openmethode}</div>
                                        <div class="vergrendeling"><strong>Vergrendeling:</strong><br>${item.vergrendeling}</div>
                                        <div class="nieuwwaarde"><strong>Nieuwwaarde:</strong><br>‚Ç¨ ${item.nieuwwaarde}</div>
                                        <div class="aankoopwaarde"><strong>Aankoopwaarde:</strong><br>‚Ç¨ ${item.aankoopwaarde}</div>
                                        <div class="aankoopdatum"><strong>Aankoopdatum:</strong><br>${item.aankoopdatum}</div>
                                        ${item.specials ? `
                                            <div class="specials">
                                                <strong>Bijzonderheden:</strong><br>
                                                ${item.specials.map(s =>
                                                    `<div>${s.link ? `<a href="${s.link}" target="_blank">${s.description}</a>` : s.description}</div>`
                                                ).join('')}
                                            </div>
                                        ` : ``}
                                    </div>
                                    <div class="right">
                                        <div class="afwerking"><strong>Afwerking:</strong><br>${item.afwerking}</div>
                                        <div class="hardheid"><strong>Hardheid:</strong><br>${item.hardheid} HRC</div>
                                        <div class="lengteGesloten"><strong>Lengte gesloten:</strong><br>${item.lengteGesloten} mm</div>
                                        <div class="lengteGeopend"><strong>Lengte geopend:</strong><br>${item.lengte} mm</div>
                                        <div class="lengteLemmet"><strong>Lengte lemmet:</strong><br>${item.lengteLemmet} mm</div>
                                        <div class="dikteLemmet"><strong>Dikte lemmet:</strong><br>${item.dikteLemmet} mm</div>
                                        <div class="gewicht"><strong>Gewicht:</strong><br>${item.gewicht} g</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }
                container.appendChild(card);
            });
        }

        function filterItems() {
            const query = document.getElementById('search').value.toLowerCase().trim();
            const selectedType = document.getElementById('filterType')?.value || 'all';
            const cards = document.querySelectorAll('.card');
            cards.forEach(card => {
                const fullText = card.textContent.toLowerCase();
                const cardMerk = card.dataset.merk;
                const cardType = card.dataset.type;
                const textMatch = query === '' || fullText.includes(query);
                const brandMatch = !activeBrand || cardMerk === activeBrand;
                const typeMatch = selectedType === 'all' || cardType === selectedType;
                card.style.display = (textMatch && brandMatch && typeMatch)
                    ? 'block'
                    : 'none';
            });
            updateSummary();
        }

        function clearSearch() {
            document.getElementById('search').value = '';
            activeBrand = null;
            document.querySelectorAll('.brand-filter')
                .forEach(el => el.classList.remove('active'));
            document.getElementById('searchBar')?.classList.remove('active');
            document.getElementById('searchSortContainer')?.classList.remove('search-active');
            filterItems();
        }

        function updateSummary() {
            const cards = document.querySelectorAll('.card');
            let messenCount = 0;
            let zaklampenCount = 0;
            let valueMessen      = 0;
            let valueZaklampen   = 0;
            let purchaseMessen    = 0;
            let purchaseZaklampen = 0;
            cards.forEach(card => {
                const type = card.dataset.type || 'onbekend';
                if (type === 'mes')       messenCount++;
                else if (type === 'zaklamp') zaklampenCount++;
                const zakmessenEl = card.querySelector('.zakmessen');
                const nwEl = card.querySelector('.nieuwwaarde');
                const awEl = card.querySelector('.aankoopwaarde');
                const nieuwwaarde = nwEl 
                    ? parseFloat(nwEl.textContent.replace(/[^0-9.,-]/g, '').replace(',', '.') || '0')
                    : 0;
                const aankoopwaarde = awEl 
                    ? parseFloat(awEl.textContent.replace(/[^0-9.,-]/g, '').replace(',', '.') || '0')
                    : 0;
                if (type === 'mes') {
                    valueMessen    += isNaN(nieuwwaarde)    ? 0 : nieuwwaarde;
                    purchaseMessen += isNaN(aankoopwaarde)  ? 0 : aankoopwaarde;
                } 
                else if (type === 'zaklamp') {
                    valueZaklampen    += isNaN(nieuwwaarde)    ? 0 : nieuwwaarde;
                    purchaseZaklampen += isNaN(aankoopwaarde)  ? 0 : aankoopwaarde;
                }
            });
            const totalValue       = valueMessen    + valueZaklampen;
            const totalPurchase    = purchaseMessen + purchaseZaklampen;
            const totalItems       = messenCount    + zaklampenCount;
            document.getElementById('totalMessen').textContent         = `${messenCount}`;
            document.getElementById('totalZaklampen').textContent      = `${zaklampenCount}`;
            document.getElementById('totalValueMessen').textContent    = `‚Ç¨ ${valueMessen.toLocaleString('nl-NL', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            document.getElementById('totalValueZaklampen').textContent = `‚Ç¨ ${valueZaklampen.toLocaleString('nl-NL', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            document.getElementById('totalPurchaseMessen').textContent    = `‚Ç¨ ${purchaseMessen.toLocaleString('nl-NL', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            document.getElementById('totalPurchaseZaklampen').textContent = `‚Ç¨ ${purchaseZaklampen.toLocaleString('nl-NL', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
        }

        const sortOptionsByType = {
            all: [
                { value: "type",         text: "Categorie"     },
                { value: "aankoopdatum", text: "Aankoopdatum"  },
                { value: "aankoopwaarde",text: "Aankoopwaarde" },
                { value: "nieuwwaarde",  text: "Nieuwwaarde"   },
                { value: "merk",         text: "Merk"          },
                { value: "naam",         text: "Naam"          },
                { value: "gewicht",      text: "Gewicht"       },
                { value: "lengte",       text: "Lengte"        }
            ],
            mes: [
                { value: "aankoopdatum", text: "Aankoopdatum"  },
                { value: "aankoopwaarde",text: "Aankoopwaarde" },
                { value: "nieuwwaarde",  text: "Nieuwwaarde"   },
                { value: "merk",         text: "Merk"          },
                { value: "naam",         text: "Naam"          },
                { value: "gewicht",      text: "Gewicht"       },
                { value: "lengteGeopend",text: "Lengte"        },
                { value: "staalsoort",   text: "Staalsoort"    },
                { value: "hardheid",     text: "Hardheid"      },
                { value: "vergrendeling",text: "Vergrendeling" },
                { value: "openmethode",  text: "Openmethode"   }
            ],
            zaklamp: [
                { value: "aankoopdatum", text: "Aankoopdatum"  },
                { value: "aankoopwaarde",text: "Aankoopwaarde" },
                { value: "nieuwwaarde",  text: "Nieuwwaarde"   },
                { value: "merk",         text: "Merk"          },
                { value: "naam",         text: "Naam"          },
                { value: "gewicht",      text: "Gewicht"       },
                { value: "lengte",       text: "Lengte"        },
                { value: "maxLumen",     text: "Max lumen"     },
                { value: "maxBereik",    text: "Max bereik"    }
            ]
        };

        function updateSortOptions() {
            const filterType = document.getElementById("filterType").value;
            const sortSelect = document.getElementById("sort");
            const optionsList = sortOptionsByType[filterType] || sortOptionsByType.all;
            const currentValue = sortSelect.value;
            sortSelect.innerHTML = '';
            optionsList.forEach(opt => {
                const option = document.createElement("option");
                option.value = opt.value;
                option.textContent = opt.text;
                sortSelect.appendChild(option);
            });
            const preferredDefault = 'aankoopdatum';
            if (optionsList.some(opt => opt.value === preferredDefault)) {
                sortSelect.value = preferredDefault;
            } else if (optionsList.length > 0) {
                sortSelect.value = optionsList[0].value;  // fallback
            }
            sortItems();
        }

        function sortItems() {
            const sortBy = document.getElementById('sort').value;
            const sortOrder = document.getElementById('sortOrder').value;
            const container = document.getElementById('itemContainer');
            const cards = Array.from(container.children);
            cards.sort((a, b) => {
                let aValue, bValue;
                if (sortBy === 'type') {
                    aValue = a.dataset.type?.toLowerCase() || '';
                    bValue = b.dataset.type?.toLowerCase() || '';
                    return sortOrder === 'asc'
                        ? aValue.localeCompare(bValue)
                        : bValue.localeCompare(aValue);
                }
                const aEl = a.querySelector(`.${sortBy}`);
                const bEl = b.querySelector(`.${sortBy}`);
                aValue = aEl ? aEl.textContent.trim() : '';
                bValue = bEl ? bEl.textContent.trim() : '';
                if (sortBy === 'aankoopdatum') {
                    const parseDate = str => {
                        const match = str.match(/\d{2}-\d{2}-\d{4}/);
                        return match ? new Date(match[0].split('-').reverse().join('-')) : new Date(0);
                    };
                    const aDate = parseDate(aValue);
                    const bDate = parseDate(bValue);
                    return sortOrder === 'asc' ? aDate - bDate : bDate - aDate;
                }
                const numericKeys = ['gewicht', 'lengte', 'aankoopwaarde', 'nieuwwaarde', 'maxLumen', 'maxBereik'];
                if (numericKeys.includes(sortBy)) {
                    const aNum = parseFloat(aValue.replace(/[^0-9.,]/g, '').replace(',', '.')) || 0;
                    const bNum = parseFloat(bValue.replace(/[^0-9.,]/g, '').replace(',', '.')) || 0;
                    return sortOrder === 'asc' ? aNum - bNum : bNum - aNum;
                }
                return sortOrder === 'asc'
                    ? aValue.localeCompare(bValue, undefined, { numeric: true, sensitivity: 'base' })
                    : bValue.localeCompare(aValue, undefined, { numeric: true, sensitivity: 'base' });
            });
            container.innerHTML = '';
            cards.forEach(card => container.appendChild(card));
            updateSummary();
        }

        document.addEventListener('click', function (e) {
            const link = e.target.closest('.brand-filter');
            if (!link) return;
            e.preventDefault();
            const merk = link.dataset.merk.toLowerCase();
            const searchInput = document.getElementById('search');
            if (activeBrand === merk) {
                activeBrand = null;
                searchInput.value = '';
                document.querySelectorAll('.brand-filter').forEach(el => el.classList.remove('active'));
            } else {
                activeBrand = merk;
                searchInput.value = merk;
                document.querySelectorAll('.brand-filter').forEach(el => el.classList.remove('active'));
                link.classList.add('active');
            }
            filterItems();
        });

        function toggleSearch() {
            const bar = document.getElementById('searchBar');
            const container = document.getElementById('searchSortContainer');
            bar.classList.toggle('active');
            container.classList.toggle('search-active');
            if (bar.classList.contains('active')) {
                document.getElementById('search').focus();
            }
        }

        function highlightCardOnScroll() {
            if (window.innerWidth > 767) return;
            const cards = document.querySelectorAll('.card');
            window.addEventListener('scroll', () => {
                const viewportMiddle = window.innerHeight / 2;
                cards.forEach(card => {
                    const rect = card.getBoundingClientRect();
                    const cardMiddle = rect.top + rect.height / 2;
                    card.classList.toggle('is-active', Math.abs(cardMiddle - viewportMiddle) < 220);
                });
            });
        }

        document.addEventListener('DOMContentLoaded', async () => {
            await loadItems();
            updateSortOptions();
            document.getElementById('sort').value = 'aankoopdatum';
            document.getElementById('sortOrder').value = 'desc';
            sortItems();
            updateSummary();
            highlightCardOnScroll();
        });

    </script>
</head>
<body>
    <div class="header1">
        <h1>Mijn EDC collectie</h1>
    </div>
    <div class="summary">
        <span>Aantal zakmessen: <span class="value" id="totalMessen">‚Äî</span></span>
        <span>Nieuwwaarde: <span class="value" id="totalValueMessen">‚Ç¨ ‚Äî</span></span>
        <span>Aankoopwaarde: <span class="value" id="totalPurchaseMessen">‚Ç¨ ‚Äî</span></span>
        <br>
        <span>Aantal zaklampen: <span class="value" id="totalZaklampen">‚Äî</span></span>
        <span>Nieuwwaarde: <span class="value" id="totalValueZaklampen">‚Ç¨ ‚Äî</span></span>
        <span>Aankoopwaarde: <span class="value" id="totalPurchaseZaklampen">‚Ç¨ ‚Äî</span></span>
        <br>
        <div class="last-update">Laatst bijgewerkt: 31-01-2026</div>
    </div>
    <div class="brand-logos">
        <div class="logo-wrapper brand-filter" data-merk="Benchmade"><img src="img/logos/Benchmade-logo.webp" alt="Benchmade"></div>
        <div class="logo-wrapper brand-filter" data-merk="Civivi"><img src="img/logos/Civivi-logo.webp" alt="Civivi"></div>
        <div class="logo-wrapper brand-filter" data-merk="Kershaw"><img src="img/logos/Kershaw-logo.webp" alt="Kershaw"></div>
        <div class="logo-wrapper brand-filter" data-merk="Kizer"><img src="img/logos/Kizer-logo.webp" alt="Kizer Knives"></div>
        <div class="logo-wrapper brand-filter" data-merk="Kunwu"><img src="img/logos/Kunwu-logo.webp" alt="Kunwu Knives"></div>
        <div class="logo-wrapper brand-filter" data-merk="Nitecore"><img src="img/logos/Nitecore-logo.webp" alt="Nitecore"></div>
        <div class="logo-wrapper brand-filter" data-merk="Olight"><img src="img/logos/Olight-logo.webp" alt="Olight"></div>
        <div class="logo-wrapper brand-filter" data-merk="Remette"><img src="img/logos/Remette-logo.webp" alt="Remette Knife"></div>
        <div class="logo-wrapper brand-filter" data-merk="Sencut"><img src="img/logos/Sencut-logo.webp" alt="Sencut"></div>
        <div class="logo-wrapper brand-filter" data-merk="Vosteed"><img src="img/logos/Vosteed-logo.webp" alt="Vosteed"></div>
        <div class="logo-wrapper brand-filter" data-merk="WE Knife"><img src="img/logos/WE-logo.webp" alt="WE Knife"></div>
        <div class="logo-wrapper"><a href="https://knivesandtools.nl" target="_blank"><img src="img/logos/KATO-logo.webp" alt="Knives and Tools" /></a></div>
        <div class="logo-wrapper"><a href="https://lamnia.com/nl" target="_blank"><img src="img/logos/Lamnia-logo.webp" alt="Lamnia" /></a></div>
        <div class="logo-wrapper"><a href="https://unlockedcomposites.com" target="_blank"><img src="img/logos/UC-logo.webp" alt="Unlocked Composites" /></a></div>      
    </div>
    <div class="search-sort-container" id="searchSortContainer">
        <button class="search-toggle" onclick="toggleSearch()">üîç</button>
        <div class="search-bar" id="searchBar">
            <input type="text" id="search" onkeyup="filterItems()" placeholder="Zoeken...">
            <button id="clear-btn" onclick="clearSearch()">‚úï</button>
        </div>
        <div class="sort-options">
            <select id="filterType" onchange="updateSortOptions(); filterItems();">
                <option value="all">Alles</option>
                <option value="mes">Zakmessen</option>
                <option value="zaklamp">Zaklampen</option>
            </select>
            <select id="sort" onchange="sortItems()">
                <!-- opties worden hier dynamisch ingevuld -->
            </select>
            <select id="sortOrder" onchange="sortItems()">
                <option value="asc">Oplopend</option>
                <option value="desc">Aflopend</option>
            </select>
        </div>
    </div>
    <div class="container" id="itemContainer"></div>
</body>
</html>
